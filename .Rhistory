knitr::opts_chunk$set(echo = TRUE)
---
title: "Reto"
knitr::opts_chunk$set(echo = TRUE)
# PACKAGES:
library(deSolve)
library(reshape2)
library(ggplot2)
initial_state_values <- c(S = 999999,  # Número de susceptibles inicial
#
I = 1,       # Se inicia con una persona infectada
R = 0)       #
#razones en unidades de días^-1
parameters <- c(beta = 1,      # razón de infección
gamma = 0.1)   # razón de recuperación
#valores de tiempo para resolver la ecuación, de 0 a 60 días
times <- seq(from = 0, to = 60, by = 1)
sir_model <- function(time, state, parameters) {
with(as.list(c(state, parameters)), {# R obtendrá los nombres de variables a
# partir de inputs de estados y parametros
N <- S+I+R
lambda <- beta * I/N
dS <- -lambda * S
dI <- lambda * S - gamma * I
dR <- gamma * I
return(list(c(dS, dI, dR)))
})
}
# poner la solución del sistema de ecuaciones en forma de un dataframe
output <- as.data.frame(ode(y = initial_state_values,
times = times,
func = sir_model,
parms = parameters))
View(output)
output_long <- melt(as.data.frame(output), id = "time")
ggplot(data = output_long,
aes(x = time, y = value, colour = variable, group = variable)) +
geom_line() +
xlab("Tiempo (días)")+
ylab("Número de individuos") +
labs(colour = "Subconjunto") +
theme(legend.position = "bottom")
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(echo = TRUE)
# PACKAGES:
library(deSolve)
library(reshape2)
library(ggplot2)
initial_state_values <- c(S = 999999,  # Número de susceptibles inicial
#
I = 1,       # Se inicia con una persona infectada
R = 0)       #
#razones en unidades de días^-1
parameters <- c(beta = 1,      # razón de infección
gamma = 0.1)   # razón de recuperación
#valores de tiempo para resolver la ecuación, de 0 a 60 días
times <- seq(from = 0, to = 60, by = 1)
sir_model <- function(time, state, parameters) {
with(as.list(c(state, parameters)), {# R obtendrá los nombres de variables a
# partir de inputs de estados y parametros
N <- S+I+R
lambda <- beta * I/N
dS <- -lambda * S
dI <- lambda * S - gamma * I
dR <- gamma * I
return(list(c(dS, dI, dR)))
})
}
# poner la solución del sistema de ecuaciones en forma de un dataframe
output <- as.data.frame(ode(y = initial_state_values,
times = times,
func = sir_model,
parms = parameters))
output_long <- melt(as.data.frame(output), id = "time")
ggplot(data = output_long,
aes(x = time, y = value, colour = variable, group = variable)) +
geom_line() +
xlab("Tiempo (días)")+
ylab("Número de individuos") +
labs(colour = "Subconjunto") +
theme(legend.position = "bottom")
View(output_long)
View(output)
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
# PACKAGES:
library(deSolve)
library(reshape2)
library(ggplot2)
initial_state_values <- c(S = 999999, I = 1, R = 0)
parameters <- c(beta = 1, gamma = 0.1)
times <- seq(from = 0, to = 60, by = 1)
sir_model <- function(time, state, parameters) {
with(as.list(c(state, parameters)), {
N <- S+I+R
lambda <- beta * I/N
dS <- -lambda * S
dI <- lambda * S - gamma * I
dR <- gamma * I
return(list(c(dS, dI, dR)))
})
}
output <- as.data.frame(ode(y = initial_state_values,
times = times,
func = sir_model,
parms = parameters))
# Gráfico del modelo base
output_long <- melt(as.data.frame(output), id = "time")
ggplot(data = output_long, aes(x = time, y = value, colour = variable)) +
geom_line(linewidth = 1) +
xlab("Tiempo (días)")+
ylab("Número de individuos") +
labs(title = "Modelo SIR Básico", colour = "Subconjunto") +
theme_minimal() +
theme(legend.position = "bottom")
# Conversión de unidades a días
mu_val <- (1/70)/365
b_val  <- (1/70)/365
parameters_p1 <- c(beta = 0.4, gamma = 0.2, mu = mu_val, b = b_val)
times_p1 <- seq(0, 365, by = 1) # 1 año
# Función SIR con dinámica vital
sir_vital_dynamics <- function(time, state, parameters) {
with(as.list(c(state, parameters)), {
N <- S + I + R
lambda <- beta * I / N
# Ecuaciones modificadas
dS <- b * N - lambda * S - mu * S
dI <- lambda * S - gamma * I - mu * I
dR <- gamma * I - mu * R
return(list(c(dS, dI, dR)))
})
}
output_p1 <- as.data.frame(ode(y = initial_state_values, times = times_p1, func = sir_vital_dynamics, parms = parameters_p1))
# Gráfico
ggplot(melt(output_p1, id="time"), aes(x=time, y=value, col=variable)) +
geom_line(linewidth=1) +
theme_minimal() +
labs(title = "Modelo con Dinámica Vital (1 año)", y="Población")
# Parámetros
N_total <- 1000000
v <- 0.8 # 80% vacunados
# Condiciones iniciales modificadas por la vacuna
# Los vacunados pasan directo a Recuperados (o un compartimento V)
init_vaccine <- c(S = (1 - v) * N_total - 1,
I = 1,
R = v * N_total)
params_vaccine <- c(beta = 0.4, gamma = 0.1)
times_vaccine <- seq(0, 365*2, by = 1) # 2 años
output_vaccine <- as.data.frame(ode(y = init_vaccine, times = times_vaccine, func = sir_model, parms = params_vaccine))
ggplot(melt(output_vaccine, id="time"), aes(x=time, y=value, col=variable)) +
geom_line(linewidth=1) +
theme_minimal() +
labs(title = "Efecto de Vacunación (80% población)", subtitle = "Notar que infectados (I) no crece exponencialmente")
times_long <- seq(0, 365*400, by = 10) # 400 años, paso de 10 días para rapidez
output_longterm <- as.data.frame(ode(y = initial_state_values, times = times_long, func = sir_vital_dynamics, parms = parameters_p1))
ggplot(melt(output_longterm, id="time"), aes(x=time/365, y=value, col=variable)) +
geom_line(linewidth=1) +
theme_minimal() +
labs(title = "Dinámica a Largo Plazo (400 años)", x = "Tiempo (Años)")
params_p4 <- c(beta=0.6, gamma=0.1)
times_p4 <- seq(0, 365*2, 1)
v_scenarios <- c(0, 0.5, 0.9)
results_list <- list()
for(v in v_scenarios){
y_init <- c(S = (1-v)*N_total - 1, I=1, R=v*N_total)
out <- as.data.frame(ode(y=y_init, times=times_p4, func=sir_model, parms=params_p4))
out$vacunacion <- paste0(v*100, "%")
results_list[[length(results_list)+1]] <- out
}
all_results <- do.call(rbind, results_list)
# Graficamos SOLO los infectados para comparar
ggplot(all_results, aes(x=time, y=I, color=vacunacion)) +
geom_line(linewidth=1) +
theme_minimal() +
labs(title = "Comparación de Infectados según % de Vacunación",
y = "Número de Infectados Activos")
